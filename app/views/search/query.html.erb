<% content_for :title, "Search - " %>
<div class ="row mx-auto">
  <div class="col-12 mt-3">
    
    <%= form_with(url: "/search", method: "get", local: true) do |fForm| %>
      <div class="col-12 text-center mb-2">
        <%= fForm.text_field :query, placeholder: " Search", value: @q,
                                     class: "mr-1" %>
        <%= fForm.submit "Go" %>
      </div>
      <div class="col-12 col-md-5 text-center mx-auto"> 
        <button type="button" class="btn btn-primary w-100" data-toggle="modal" data-target="#filterModal">Filter Results</button>
      </div>
      <div class="modal" id="filterModal" tabindex="-1" role="dialog" aria-labelledby="filterModalTitle" aria-hidden-"true">
        <div class="modal-dialog modal-dialog-centered card-text-color" role="document">
          <div class="modal-content card-bg-color">
            <div class="modal-header">
              <h5 class="modal-title" id="filterModalTitle">Filters</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">

              <h5>Recipe tags:</h5>
              <div class="font-sm">
                <% RecipeType.all.each do |rt| %>
                  <% if rt.recipes.count > 0 %>
                    <% if @filter && @filter.include?(rt[:name]) %>
                      <%= check_box_tag("rTypes[]selected", rt[:name], checked=true) %>
                    <% else %>
                      <%= check_box_tag("rTypes[]selected", rt[:name], checked=false) %>
                    <% end %>
                    <%= fForm.label rt[:name] %>
                  <% end %>
                  <br>
                <% end %>
              </div>
              <br>

              <h5>Ingredient tags:</h5>
              <div class="font-sm">
              <% IngredientTag.all.each do |it| %>
                <% if it.ingredients.count > 0 %>
                  <% if @filter && @filter.include?(it[:name]) %>
                    <%= check_box_tag("iTags[]selected", it[:name], checked=true) %>
                  <% else %>
                    <%= check_box_tag("iTags[]selected", it[:name], checked=false) %>
                  <% end %>
                  <%= fForm.label it[:name] %>
                <% end %>
                <br>
              <% end %>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>

    <% end %>

  </div>
</div>
<div class="row">
  <div class="col-12">
    
    <div>Showing <%= @results.count %> of <%= @total %> recipes</div>
    <% unless @q.nil? || @q == "" %>
      <div>Search: <%= @q %></div>
    <% end %>
    <div><%= @filter %></div>
  </div>
</div>
<hr>
<div class="row col-12 p-0 mx-auto">
  <% @results.each do |r| %>
    <%= render 'shared/recipe_link', rec: r %>
  <% end %>
</div>
